# Set the file paths
$dimensionsFile = "C:\dimensions.csv"
$expressionsFile = "C:\expressions.csv"
$templateFile = "C:\template.json"
$outputFile = "C:\output.json"

# Read in the CSV files
$dimensions = Import-Csv $dimensionsFile
$expressions = Import-Csv $expressionsFile

# Read in the template JSON
$template = Get-Content $templateFile | ConvertFrom-Json

# Create a new array to store the dimensions
$dimensionsArray = @()

# Loop through each row in the dimensions CSV
foreach ($row in $dimensions) {
    # Create a new object for the dimension
    $dimension = [PSCustomObject]@{
        qDef = @{
            qFieldDefs = $row.qFieldDefs
            qLabelExpression = $row.qLabelExpression
        }
    }

    # Add the dimension to the dimensions array
    $dimensionsArray += $dimension
}

# Create a new array to store the measures
$measuresArray = @()

# Loop through each row in the expressions CSV
foreach ($row in $expressions) {
    # Create a new object for the measure
    $measure = [PSCustomObject]@{
        qDef = @{
            qLabelExpression = $row.qLabelExpression
        }
    }

    # Add the measure to the measures array
    $measuresArray += $measure
}

# Merge the dimensions and measures arrays with the template JSON
$output = $template | Select-Object *

$output.qHyperCubeDef.qDimensions = $dimensionsArray
$output.qHyperCubeDef.qMeasures = $measuresArray

# Convert the output to JSON and write it to a file
$output | ConvertTo-Json -Depth 10 | Out-File $outputFile
